<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Debug Video Link</title>
    <link rel="stylesheet" href="/static/tagger.css" />
    <style>
      body {
        padding: 20px;
        background: #1a1a1a;
        color: white;
        font-family: Arial;
      }
      .debug {
        background: #2d2d2d;
        padding: 15px;
        margin: 15px 0;
        border-radius: 8px;
      }
      button {
        padding: 10px;
        margin: 5px;
        background: #4caf50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h1>Debug Video Link Issue</h1>

    <div class="debug">
      <h2>Current Button State</h2>
      <div class="video-link-section">
        <a href="#" target="_blank" class="video-link-btn" id="videoLinkBtn">
          Open video in new tab
        </a>
      </div>

      <p><strong>Current href:</strong> <span id="currentHref">#</span></p>

      <button onclick="checkCurrentLink()">Check Current Link</button>
      <button onclick="setTestLink()">Set Test YouTube Link</button>
      <button onclick="simulateVideoLoad()">Simulate Video Load</button>
      <button onclick="testAPICall()">Test API Call</button>
    </div>

    <div class="debug">
      <h2>Test Results</h2>
      <div id="testResults"></div>
    </div>

    <script>
      function logResult(message) {
        const results = document.getElementById("testResults");
        results.innerHTML +=
          "<p>" + new Date().toLocaleTimeString() + ": " + message + "</p>";
        console.log(message);
      }

      function checkCurrentLink() {
        const btn = document.getElementById("videoLinkBtn");
        const href = btn ? btn.href : "Element not found";
        document.getElementById("currentHref").textContent = href;
        logResult("Current button href: " + href);
      }

      function setTestLink() {
        const btn = document.getElementById("videoLinkBtn");
        const testLink = "https://www.youtube.com/watch?v=2vjPBrBU-TM";
        if (btn) {
          btn.href = testLink;
          document.getElementById("currentHref").textContent = testLink;
          logResult("Manually set href to: " + testLink);
        } else {
          logResult("ERROR: Button element not found");
        }
      }

      function simulateVideoLoad() {
        const testVideo = {
          Link: "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
          Narrative: "Test narrative",
          Title: "Test Video",
        };

        // Simulate the displayVideo function logic
        const videoLinkBtn = document.getElementById("videoLinkBtn");
        console.log("Video data:", testVideo);
        console.log("Video link button element:", videoLinkBtn);
        console.log("Video Link from API:", testVideo.Link);

        if (videoLinkBtn && testVideo.Link) {
          videoLinkBtn.href = testVideo.Link;
          document.getElementById("currentHref").textContent = testVideo.Link;
          console.log("Updated button href to:", videoLinkBtn.href);
          logResult(
            "Simulated video load - href updated to: " + testVideo.Link
          );
        } else {
          console.log("Failed to update link - missing element or link");
          logResult("ERROR: Failed to update link");
        }
      }

      async function testAPICall() {
        try {
          logResult("Making API call to get random narrative...");
          const response = await fetch("/random-narrative");
          const video = await response.json();
          logResult("API Response: " + JSON.stringify(video, null, 2));

          // Now update the button
          const videoLinkBtn = document.getElementById("videoLinkBtn");
          if (videoLinkBtn && video.Link) {
            videoLinkBtn.href = video.Link;
            document.getElementById("currentHref").textContent = video.Link;
            logResult("Updated button with real API data: " + video.Link);
          } else {
            logResult("ERROR: Could not update button with API data");
          }
        } catch (error) {
          logResult("ERROR: API call failed - " + error.message);
        }
      }

      // Initial check
      window.onload = function () {
        checkCurrentLink();
      };
    </script>
  </body>
</html>
